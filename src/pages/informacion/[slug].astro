---
import Layout from '@/layouts/vinos.astro';
import { supabase } from '@/lib/supabase';
import type { Wine, Peticion } from '../interface';
import InfoHeader from '@/components/infoHeader/InfoHeader.astro';
import InformacionReact from './informacionReact';

const { slug } = Astro.params;

export const getStaticPaths = async () => {
  const { data: vinos, error } = await supabase
    .from('vinos')
    .select('nombre, variedades(variedad)');

  if (error) {
    console.error(error);
    return { paths: [], fallback: false };
  }

  const filtered = vinos as unknown as Peticion[];
  const paths = filtered.map(({ nombre, variedades }) => {
    const ruta = `${nombre}~${variedades.variedad}`.replace(/\s+/g, '-');
    return { params: { 'slug': ruta } };
  });

  return paths
};

function separarSlug(slug: string) {
  const [nombre, variedad] = slug.split('~');
  
  return { 
    nombre: nombre.replace(/-/g, ' '), 
    variedad: variedad.replace(/-/g, ' ') 
  };
}

const { nombre } = separarSlug(slug);
const { variedad } = separarSlug(slug);
---

<Layout title={`${nombre + " " + variedad}`.toString()}>
  <InfoHeader />
  <InformacionReact nombre={nombre} variedad={variedad} client:load />
</Layout>